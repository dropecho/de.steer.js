var DE=DE||{};DE.Steer=DE.Steer||{};
DE.Steer.Behaviors=function(){function a(){}a.prototype.Align=function(b,a){for(var d=DE.Math.Vec2d(),e=a.length,f=0;f<e;++f)d.Add(a[f]);0<e&&(d.Scale(1/e),d.Sub(b));return d};a.prototype.Arrive=function(b,a,d,e){e=e||5;var f=b.DistanceFrom(a);return 0<f?(d=DE.Math.Clamp(f/e,0,d),this.Seek(b,a,d)):DE.Math.Vec2d(0,0)};a.prototype.Cohese=function(b,a,d){for(var e=DE.Math.Vec2d(0,0),f=a.length,g=0;g<f;g++)e.Add(a[g]);return 0<f?(e.Scale(1/f),this.Arrive(b,e,d)):DE.Math.Vec2d(0,0)};a.prototype.Evade=
function(b,a,d,e,f){var g=DE.Math.Vector.Sub(a,b);e=DE.Math.HeadingVec(e);f=f||60;d=g.Length()/(d+f);a=DE.Math.Vector.Add(a,e.Normalize(d));return this.Flee(b,a)};a.prototype.Flee=function(b,a,d,e){e=void 0===e||-1===e||a.DistanceFrom(b)<=e;b=DE.Math.Vector.Sub(b,a).Normalize(d);return e?b:DE.Math.Vec2d(0,0)};a.prototype.Hide=function(){};a.prototype.Interpose=function(b,a,d,e){a=DE.Math.Vector.MidPoint(a,d);return Arrive(b,a,e)};a.prototype.ObstacleAvoid=function(){};a.prototype.Pursuit=function(a,
c,d,e,f){var g=DE.Math.Vector.Sub(c,a);e=e instanceof DE.Math.Vector?e:DE.Math.HeadingVec(targetHeadingDeg);f=f||60;d=g.Length()/(d+f);c=DE.Math.Vector.Add(c,e.Normalize(d));return this.Seek(a,c)};a.prototype.Seek=function(a,c,d){return DE.Math.Vector.Sub(c,a).Normalize(d)};a.prototype.Seperation=function(a,c){for(var d=DE.Math.Vec2d(0,0),e=c.length,f=0;f<e;f++){var g=DE.Math.Vector.Sub(a,c[f]),h=g.Length();d.Add(g.Normalize(128/h))}return d};a.prototype.Wander=function(a,c,d){var e=DE.Math.Rand(-1,
1),f=DE.Math.Rand(-1,1),e=DE.Math.Vec2d(e,f).Normalize();c.Add(e).Normalize(1);c=DE.Math.Vector.Add(c,DE.Math.Vec2d(10,0));d=DE.Math.Vector.LocalToWorld(c,d,a);return this.Seek(a,d,1)};return new a}();DE=DE||{};DE.Steer=DE.Steer||{};
DE.Steer.EntityBehaviors=function(){function a(a){this.entity=a;this.de_wander_target=DE.Math.Vec2d()}a.prototype.ToLocal=function(a){return DE.Math.Vector.WorldToLocal(a,this.entity.de_heading())};a.prototype.Align=function(){};a.prototype.Arrive=function(a,c){var d=this.entity.de_pos(),e=a.de_pos(),f=this.entity.de_max_speed();return DE.Steer.Behaviors.Arrive(d,e,f,c)};a.prototype.Cohese=function(a){for(var c=this.entity.de_pos(),d=this.entity.de_max_speed(),e=[],f=0,g=a.length;f<g;f++)e.push(a.de_pos());
return DE.Steer.Behaviors.Cohese(c,e,d)};a.prototype.Evade=function(){var a=this.entity.de_pos(),c=this.entity.de_max_speed(),d=target.de_pos(),e=target.de_heading(),f=target.de_max_speed();return DE.Steer.Behaviors.Evade(a,d,c,e,f)};a.prototype.Flee=function(a,c){var d=this.entity.de_pos();target.de_pos();var e=this.entity.de_max_speed();return DE.Steer.Behaviors.Flee(d,target,e,c)};a.prototype.Hide=function(){};a.prototype.Interpose=function(){};a.prototype.ObstacleAvoid=function(){};a.prototype.Pursuit=
function(){var a=this.entity.de_pos(),c=this.entity.de_max_speed(),d=target.de_pos(),e=target.de_heading(),f=target.de_max_speed();return DE.Steer.Behaviors.Pursuit(a,d,c,e,f)};a.prototype.Seek=function(a){var c=this.entity.de_pos(),d=this.entity.de_max_speed();a=a.de_pos();return DE.Steer.Behaviors.Seek(c,a,d)};a.prototype.Seperation=function(a){for(var c=this.entity.de_pos(),d=[],e=0,f=a.length;e<f;e++)d.push(a.de_pos());return DE.Steer.Behaviors.Seperation(c,d)};a.prototype.Wander=function(){var a=
this.entity.de_pos(),c=this.de_wander_target,d=this.entity.de_heading();return DE.Steer.Behaviors.Wander(a,c,d)};return a}();DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.Extenders=DE.Steer.Extenders||{};
DE.Steer.Extender=function(){return new function(){this.Extend=function(a,b){if(void 0===a)throw new DE.Errors.ConversionError({property:"entity",message:"is undefined. Pass a non-null entity."});if(a instanceof DE.Math.Vector)return a;b=b||a.prototype&&a.prototype.constructor&&a.prototype.constructor.name;if(void 0===DE.Steer.Extenders[b])throw new DE.Errors.ConversionError({property:"DE.Steer.Extenders."+b,message:"is undefined.  Register a converter for this type."});if(1>DE.Steer.Extenders[b].length)throw new DE.Errors.ConversionError({property:"DE.Steer.Extenders."+
b,message:"must accept at least one arg, which is the entity to be converted."});var c=DE.Steer.Extenders[b](a);if(void 0===c.de_pos)throw new DE.Errors.ConversionError({property:"entity.de_pos",message:"is undefined. You must set the position getter in the converter."});if("function"!==typeof c.de_pos)throw new DE.Errors.ConversionError({property:"entity.de_pos",message:"is not a function. You must set the position getter in the converter."});if(void 0===c.de_heading)throw new DE.Errors.ConversionError({property:"entity.de_heading",
message:"is undefined. You must set the heading getter in the converter."});if("function"!==typeof c.de_heading)throw new DE.Errors.ConversionError({property:"entity.de_heading",message:"is not a function. You must set the heading getter in the converter."});if(void 0===c.de_max_speed)throw new DE.Errors.ConversionError({property:"entity.de_max_speed ",message:"is undefined. You must set the max_speed getter in the converter."});if("function"!==typeof c.de_max_speed)throw new DE.Errors.ConversionError({property:"entity.de_max_speed",
message:"is not a function. You must set the max_speed getter in the converter."});c.Steering=new DE.Steer.EntityBehaviors(a);return c}}}();DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.Extenders=DE.Steer.Extenders||{};DE.Steer.Extenders.GameQuery=function(a,b){a.max_speed=b||10;a.de_pos=function(){return DE.Math.Vec2d(a.xy())};a.de_heading=function(){return DE.Math.HeadingVec(a.rotate())};a.de_max_speed=function(){return a.max_speed};return a};DE=DE||{};DE.Math=DE.Math||{};DE.Math.PI=void 0!==Math?Math.PI:3.141592653;DE.Math.Clamp=function(a,b,c){a=Math.min(a,c);return Math.max(b,a)};DE.Math.Rand=function(a,b){return void 0!==a?DE.Math.Clamp(Math.random()*b,a,b):Math.random()};DE.Math.RadToDeg=function(a){return DE.Math.CleanFloat(180*a/DE.Math.PI)};DE.Math.DegToRad=function(a){return DE.Math.CleanFloat(a*DE.Math.PI/180)};DE.Math.CleanFloat=function(a){return parseFloat(a.toFixed(7))};DE=DE||{};DE.Math=DE.Math||{};
DE.Math.Vector=function(){function a(a,c){"object"===typeof DE.Util.Unwrap(a)?(this.x=DE.Util.Unwrap(a.x)||0,this.y=DE.Util.Unwrap(a.y)||0):(this.x=DE.Util.Unwrap(a)||0,this.y=DE.Util.Unwrap(c)||0)}a.prototype.Scale=function(a){a=DE.Util.Unwrap(a)||1;this.x*=a;this.y*=a;return this};a.prototype.Add=function(a){a=DE.Util.Unwrap(a);this.x+=a.x;this.y+=a.y;return this};a.prototype.Sub=function(a){a=DE.Util.Unwrap(a);this.x-=a.x;this.y-=a.y;return this};a.prototype.Dot=function(a){a=DE.Util.Unwrap(a);
return this.x*a.x+this.y*a.y};a.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.LengthSQ=function(){return this.x*this.x+this.y*this.y};a.prototype.DistanceFrom=function(b){b=DE.Util.Unwrap(b);return(new a(this.x-b.x,this.y-b.y)).Length()};a.prototype.Normalize=function(a){var c=this.Length(),c=0!=c?1/c:1;this.x*=c;this.y*=c;0<a&&this.Scale(a);return this};a.prototype.Perp=function(){return DE.Math.Vec2d(-this.y,this.x)};return a}();
DE.Math.Vec2d=function(a,b){return new DE.Math.Vector(a,b)};DE.Math.HeadingVec=function(a){var b=DE.Math.DegToRad(a);a=DE.Math.CleanFloat(Math.cos(b));b=DE.Math.CleanFloat(Math.sin(b));return DE.Math.Vec2d(a,b)};DE.Math.Vector.Add=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return DE.Math.Vec2d(a.x+b.x,a.y+b.y)};DE.Math.Vector.Sub=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return DE.Math.Vec2d(a.x-b.x,a.y-b.y)};
DE.Math.Vector.Normalize=function(a,b){var c=DE.Math.Vec2d(a.x,a.y),d=c.Length(),d=0!=d?1/d:1;c.x*=d;c.y*=d;0<b&&c.Scale(b);return c};DE.Math.Vector.HeadingToDeg=function(a){var b=DE.Math.Vec2d(1,0);a=DE.Math.Vector.Normalize(a);b=DE.Math.RadToDeg(Math.acos(b.Dot(a)));0>a.y&&(b=360-b);return b};DE.Math.Vector.WorldToLocal=function(a,b){var c=b.Perp(),c=[[b.x,c.x],[b.y,c.y]];return DE.Math.Vec2d(a.x*c[0][0]+a.y*c[0][1],a.x*c[1][0]+a.y*c[1][1])};
DE.Math.Vector.LocalToWorld=function(a,b,c){var d=DE.Math.Vec2d(1,0);b=DE.Math.Vector.HeadingToDeg(b);d=DE.Math.Vector.WorldToLocal(DE.Math.HeadingVec(-b),d);b=d.Perp();b=[[d.x,b.x],[d.y,b.y]];d=DE.Math.CleanFloat(a.x*b[0][0]+a.y*b[0][1]);a=DE.Math.CleanFloat(a.x*b[1][0]+a.y*b[1][1]);return DE.Math.Vec2d(d,a).Add(c)};DE.Math.Vector.MidPoint=function(a,b){return DE.Vec2d(0.5*(a.x+b.x),0.5*(a.y+b.y))};
DE.Math.Vector.HeadingToDegTest=function(){for(var a=0;360>a;a++){var b=DE.Math.CleanFloat(Math.cos(DE.Math.DegToRad(a))),c=DE.Math.CleanFloat(Math.sin(DE.Math.DegToRad(a))),b=DE.Math.Vec2d(b,c),c=DE.Math.Vector.HeadingToDeg(b);(c<a-1E-4||c>a+1E-4)&&console.log("heading:",b,"got:",c," Expected:",a)}};
DE.Math.Vector.VecTest=function(){for(var a=DE.Vec2d(1,0),b=0;360>=b;b+=5){var c=DE.Math.Vector.WorldToLocal(a,DE.Math.HeadingVec(b)),c=DE.Math.Vector.LocalToWorld(c,DE.Math.HeadingVec(b),DE.Math.Vec2d(0,0));(c.x<a.x-1E-4||c.x>a.x+1E-4)&&console.log("AT: ",b," Expected x to be:",a.x,"  Got:",c.x);(c.y<a.y-1E-4||c.y>a.y+1E-4)&&console.log("AT: ",b," Expected x to be:",a.y,"  Got:",c.y)}};DE=DE||{};DE.Errors={};DE.Errors.ConversionError=function(a){this.name=a.name||"Extender Error";this.message=a.message||"Unknown Error.";this.property=a.property+" "||"";this.toString=function(){return this.name+": "+this.property+this.message}};DE=DE||{};DE.Util=DE.Util||{};DE.Util.Unwrap=function(a){return"function"===typeof a?a():a};DE.Util.RemoveElement=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);c.splice(b,1);return c};
